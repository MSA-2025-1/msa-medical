<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.emr.slgi.patient.dao.ReservationDAO">

    <sql id="afterToday">
        RESERVATION_DATE > #{reservationDate}
        AND
    </sql>

    <sql id="today">
        <![CDATA[
            RESERVATION_DATE >= #{reservationDate}
            AND
            RESERVATION_DATE < DATE_ADD(DATE(#{reservationDate}), INTERVAL 1 DAY)
            AND
        ]]>
    </sql>

    <insert id="makeReservation">
        INSERT INTO
            TB_RESERVATION
        VALUES
            (
                UUID(),
                #{patientUuid}, -- 임시 데이터
                #{doctorUuid},
                'RS01', -- 임시 데이터
                #{dateTime},
                #{symptom}
            )
    </insert>

    <select id="getReservationList"
            parameterType="com.emr.slgi.patient.dto.Reservation"
            resultType="com.emr.slgi.patient.dto.ReservationList"
    >
        SELECT
            PATIENT_UUID, DOCTOR_UUID, RESERVATION_DATE
        FROM
            TB_RESERVATION
        WHERE
            DOCTOR_UUID = #{doctorUuid}
            AND
            <choose>
                <when test="isToday">
                    <include refid="today"/>
                </when>
                <otherwise>
                    <include refid="afterToday"/>
                </otherwise>
            </choose>
            STATUS IN ('RS01', 'RS02')
    </select>

</mapper>